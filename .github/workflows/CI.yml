name: CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  ci:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]

        steps:
          - name: Checkout
            uses: actions/checkout@v4

          - name: Install zig
            if: runner.os != 'Windows'
            run: |
              brew install zig

          - name: Install zig
            if: runner.os == 'Windows'
            run: |
              choco install zig -y

          - name: Build Debug
            working-directory: ${{github.workspace}}/test-crate
            shell: bash
            run: |
              output=`cargo run -- GitHub`
                if [ "$output" != "Hello, GitHub!" ]; then
                  echo "Unexpected output: $output"
                  exit 1
                fi
